<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Tr√≤ Ch∆°i Gi·∫£i Lao: "T√¥i L√† Ai?"</title>
	<link rel="icon" type="image/gaming" href="images/gaming.ico">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            font-family: 'Comic Neue', cursive;
            background: linear-gradient(135deg, #A8E6CF, #D4EEFF, #C7CEEA);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background: #ffffff;
            border-radius: 40px;
            padding: 35px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.2), 0 6px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border: 5px solid #9FD9B7;
            position: relative;
            min-height: 400px;
            transition: transform 0.3s ease-in-out;
        }
        .container:hover {
            transform: translateY(-5px);
        }
        .game-content {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            flex: 1;
            padding-right: 25px;
            max-width: 60%;
        }
        h1 {
            font-family: 'Dancing Script', cursive;
            text-align: left;
            color: #3BB143;
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
            width: 100%;
            text-shadow: 2px 2px 5px rgba(59,177,67,0.3);
        }
        .question {
            font-size: 26px;
            margin: 15px 0;
            text-align: left;
            color: #2F4F4F;
            background: #E8F5E9;
            padding: 25px;
            border-radius: 25px;
            width: 100%;
            box-sizing: border-box;
            border: 2px dashed #81C784;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        .answers {
            width: 100%;
            max-width: 450px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 25px;
        }
        .answers button {
            padding: 18px;
            font-size: 20px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(90deg, #64B5F6, #4DB6AC);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .answers button:hover:not(:disabled) {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            background: linear-gradient(90deg, #42A5F5, #26A69A);
        }
        .answers button.correct {
            background: linear-gradient(90deg, #8BC34A, #388E3C);
            box-shadow: 0 5px 15px rgba(0, 178, 0, 0.4);
        }
        .answers button.wrong {
            background: linear-gradient(90deg, #FF7043, #FF3D00);
            box-shadow: 0 5px 15px rgba(255, 0, 0, 0.4);
        }
        .answers button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }
        .feedback {
            margin-top: 25px;
            font-weight: 700;
            font-size: 22px;
            text-align: left;
            min-height: 30px;
            width: 100%;
            color: #388E3C;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
        }
        .feedback.wrong-try-again {
            color: #FF7043;
        }
        .feedback.wrong-final {
            color: #D32F2F;
        }
        .feedback.hint-msg {
            color: #1976D2;
        }
        #nextBtn, #hintBtn, #backToMenuBtn {
            margin-top: 25px;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            color: white;
            border-radius: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: flex-start;
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        #nextBtn {
            background: linear-gradient(90deg, #66BB6A, #43A047);
        }
        #nextBtn:hover:not(:disabled) {
            background: linear-gradient(90deg, #43A047, #388E3C);
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        #hintBtn {
            background: linear-gradient(90deg, #81D4FA, #29B6F6);
            margin-left: 10px;
        }
        #hintBtn:hover:not(:disabled) {
            background: linear-gradient(90deg, #29B6F6, #0288D1);
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        #hintBtn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }
        #backToMenuBtn {
            background: linear-gradient(90deg, #FFB74D, #FF9800);
            margin-left: 10px;
        }
        #backToMenuBtn:hover:not(:disabled) {
            background: linear-gradient(90deg, #FF9800, #FB8C00);
            transform: translateY(-3px) scale(1.01);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        #backToMenuBtn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }
        .animal-image-container {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .animal-image {
            width: 300px;
            height: 250px;
            object-fit: contain;
            border-radius: 20px;
            border: 4px solid #8BC34A;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            animation: fadeIn 0.7s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.7) rotate(10deg); }
            to { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        /* M√†n h√¨nh Menu Ch√≠nh */
        .hidden {
            display: none !important;
        }
        .main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #A8E6CF, #D4EEFF, #C7CEEA);
            height: 100vh;
            width: 100vw;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            animation: fadeIn 0.8s ease-out;
        }
        .main-menu h1 {
            font-family: 'Comic Neue', cursive;
            color: #2F4F4F;
            font-size: 3.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }
        .main-menu .game-title-menu {
            font-family: 'Dancing Script', cursive;
            color: #3BB143;
            font-size: 4.5em;
            font-weight: 700;
            margin-bottom: 40px;
            text-shadow: 3px 3px 7px rgba(59,177,67,0.4);
            text-align: center;
            line-height: 1.2;
        }
        .menu-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }
        .menu-buttons button { /* √Åp d·ª•ng chung cho c√°c n√∫t tr√™n menu */
            padding: 20px 40px;
            font-size: 2.2em;
            border-radius: 30px;
            border: none;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            letter-spacing: 1px;
            width: 80%;
            max-width: 400px;
        }
        .start-button {
            background: linear-gradient(90deg, #FFC0CB, #9FD9B7);
        }
        .start-button:hover {
            transform: translateY(-7px) scale(1.03);
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
            background: linear-gradient(90deg, #FF99AA, #7CB342);
        }
        .continue-button {
            background: linear-gradient(90deg, #81D4FA, #29B6F6);
        }
        .continue-button:hover {
            transform: translateY(-7px) scale(1.03);
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
            background: linear-gradient(90deg, #29B6F6, #0288D1);
        }
        .menu-image {
            width: 450px;
            height: auto;
            margin-top: 50px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: float 3s ease-in-out infinite alternate;
        }
        @keyframes float {
            0% { transform: translateY(0px); }
            100% { transform: translateY(-15px); }
        }
        /* N√∫t C√†i ƒë·∫∑t tr√™n Menu ch√≠nh */
        .settings-button {
            padding: 15px 30px;
            font-size: 1.8em;
            border-radius: 25px;
            border: none;
            background: linear-gradient(90deg, #ADD8E6, #87CEEB);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .settings-button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            background: linear-gradient(90deg, #87CEEB, #4682B4);
        }
        /* Pop-up C√†i ƒë·∫∑t */
        .settings-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            animation: fadeIn 0.3s ease-out;
        }
        .popup-content {
            background: #ffffff;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
            text-align: center;
            max-width: 500px;
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px;
            transform: scale(0.9);
            animation: popIn 0.3s forwards cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }
        @keyframes popIn {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .popup-content h2 {
            font-family: 'Dancing Script', cursive;
            color: #3BB143;
            font-size: 3.2em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 5px rgba(59,177,67,0.2);
        }
        /* ƒêi·ªÅu khi·ªÉn b·∫≠t/t·∫Øt √¢m thanh t·ªïng */
        .audio-control {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid #9FD9B7;
            font-weight: 700;
            color: #2F4F4F;
        }
        .audio-control:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
            background: rgba(255, 255, 255, 0.95);
        }
        .audio-icon {
            width: 35px;
            height: 35px;
        }
        #audioStatus {
            font-size: 1.2em;
        }
        /* T√πy ch·ªânh √¢m l∆∞·ª£ng chi ti·∫øt */
        .volume-controls {
            margin-top: 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border: 2px solid #D4EEFF;
            width: 100%;
            max-width: 350px;
        }
        .volume-slider-group {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            font-weight: 600;
            color: #2F4F4F;
        }
        .volume-slider-group label {
            min-width: 90px;
        }
        .volume-slider-group .volume-icon {
            width: 25px;
            height: 25px;
            vertical-align: middle;
        }
        .volume-slider {
            flex-grow: 1;
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 10px;
            background: #D3D3D3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;
            border-radius: 5px;
        }
        .volume-slider:hover {
            opacity: 1;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #8BC34A;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #8BC34A;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        /* N√∫t ƒê√≥ng trong pop-up */
        .close-popup-button {
            padding: 12px 25px;
            font-size: 1.3em;
            border-radius: 20px;
            border: none;
            background: linear-gradient(90deg, #FF6F61, #E63946);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        .close-popup-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            background: linear-gradient(90deg, #E63946, #CC2936);
        }
        /* Media queries cho m√†n h√¨nh nh·ªè */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 25px;
                min-height: auto;
                align-items: center;
                border-radius: 30px;
            }
            .game-content {
                max-width: 100%;
                padding-right: 0;
                align-items: center;
            }
            h1, .question, .feedback {
                text-align: center;
                font-size: 38px;
            }
            .question {
                font-size: 22px;
                padding: 20px;
            }
            .answers {
                max-width: 100%;
                padding: 0 10px;
            }
            .answers button {
                font-size: 18px;
                padding: 15px;
            }
            #nextBtn, #hintBtn, #backToMenuBtn {
                align-self: center;
                margin-top: 20px;
                font-size: 16px;
                padding: 12px 25px;
            }
            .animal-image-container {
                position: static;
                max-width: 90%;
                margin-top: 30px;
                right: auto;
                top: auto;
                transform: none;
                background: none;
                box-shadow: none;
            }
            .animal-image {
                width: 200px;
                height: auto;
                border-radius: 15px;
                border: 3px solid #8BC34A;
            }
            /* Media queries cho menu tr√™n thi·∫øt b·ªã nh·ªè */
            .main-menu h1 {
                font-size: 2.5em;
            }
            .main-menu .game-title-menu {
                font-size: 3.5em;
            }
            .menu-buttons button { /* √Åp d·ª•ng cho n√∫t tr√™n menu */
                font-size: 1.8em;
                padding: 15px 30px;
            }
            .menu-image {
                width: 80%;
                margin-top: 30px;
            }
            /* C√†i ƒë·∫∑t pop-up tr√™n thi·∫øt b·ªã nh·ªè */
            .settings-button {
                font-size: 1.5em;
                padding: 12px 25px;
            }
            .popup-content {
                padding: 25px;
                gap: 15px;
            }
            .popup-content h2 {
                font-size: 2.5em;
                margin-bottom: 15px;
            }
            .audio-control,
            .volume-controls {
                width: 100%;
                max-width: 100%;
                padding: 15px;
            }
            .audio-icon {
                width: 28px;
                height: 28px;
            }
            #audioStatus {
                font-size: 1em;
            }
            .volume-slider-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            .volume-slider-group label {
                min-width: auto;
                text-align: left;
            }
        }
    </style>
</head>
<body>
    <div class="main-menu" id="mainMenu">
        <h1>Ch√†o m·ª´ng b√© ƒë·∫øn v·ªõi</h1>
        <h2 class="game-title-menu">Tr√≤ Ch∆°i "T√¥i L√† Ai?"</h2>
        <div class="menu-buttons">
            <button class="start-button" id="newGameBtn" onclick="startNewGame()"></button>
            <button class="continue-button hidden" id="continueGameBtn" onclick="continueGame()">‚û°Ô∏è Ti·∫øp t·ª•c ch∆°i</button>
        </div>
        <button class="settings-button" onclick="showSettings()">‚öôÔ∏è C√†i ƒë·∫∑t</button>
        <img src="image/welcome_animals.webp" alt="Ch√†o m·ª´ng ƒë·∫øn v·ªõi th·∫ø gi·ªõi ƒë·ªông v·∫≠t" class="menu-image">
    </div>

    <div class="settings-popup hidden" id="settingsPopup">
        <div class="popup-content">
            <h2>‚öôÔ∏è C√†i ƒë·∫∑t √Çm thanh</h2>
            <div class="audio-control" onclick="toggleBackgroundMusic()">
                <img id="audioIcon" src="ui/audio_on.png" alt="√Çm thanh b·∫≠t" class="audio-icon">
                <span id="audioStatus">√Çm thanh: B·∫≠t</span>
            </div>

            <div class="volume-controls">
                <div class="volume-slider-group">
                    <label for="bgVolume">Nh·∫°c n·ªÅn:</label>
                    <img src="ui/volume_down.png" alt="Gi·∫£m √¢m l∆∞·ª£ng" class="volume-icon">
                    <input type="range" id="bgVolume" class="volume-slider" min="0" max="1" step="0.05" value="0.05" oninput="setBackgroundMusicVolume(this.value)">
                    <img src="ui/volume_up.png" alt="TƒÉng √¢m l∆∞·ª£ng" class="volume-icon">
                </div>
                <div class="volume-slider-group">
                    <label for="effectVolume">Hi·ªáu ·ª©ng:</label>
                    <img src="ui/volume_down.png" alt="Gi·∫£m √¢m l∆∞·ª£ng" class="volume-icon">
                    <input type="range" id="effectVolume" class="volume-slider" min="0" max="1" step="0.05" value="0.7" oninput="setEffectSoundVolume(this.value)">
                    <img src="ui/volume_up.png" alt="TƒÉng √¢m l∆∞·ª£ng" class="volume-icon">
                </div>
                <div class="volume-slider-group">
                    <label for="animalVolume">ƒê·ªông v·∫≠t:</label>
                    <img src="ui/volume_down.png" alt="Gi·∫£m √¢m l∆∞·ª£ng" class="volume-icon">
                    <input type="range" id="animalVolume" class="volume-slider" min="0" max="1" step="0.05" value="0.8" oninput="setAnimalSoundVolume(this.value)">
                    <img src="ui/volume_up.png" alt="TƒÉng √¢m l∆∞·ª£ng" class="volume-icon">
                </div>
            </div>
            <button class="close-popup-button" onclick="hideSettings()">ƒê√≥ng</button>
        </div>
    </div>

    <div class="container hidden" id="gameContainer">
        <div class="game-content">
            <h1>üéÆ B√© ƒëo√°n xem t√¥i l√† ai?</h1>
            <div class="question" id="question">C√¢u h·ªèi s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</div>
            <div class="answers">
                <button onclick="checkAnswer(0)"></button>
                <button onclick="checkAnswer(1)"></button>
                <button onclick="checkAnswer(2)"></button>
            </div>
            <div class="feedback" id="feedback"></div>
            <div style="display: flex; gap: 10px; margin-top: 0;">
                <button id="hintBtn" onclick="playHintSound()">üé∂ G·ª£i √Ω √¢m thanh</button>
                <button id="nextBtn" class="hidden" onclick="nextQuestion()">‚û°Ô∏è C√¢u h·ªèi ti·∫øp theo</button>
                <button id="backToMenuBtn" onclick="backToMainMenu()">üè† V·ªÅ menu</button>
            </div>
        </div>

        <div class="animal-image-container" id="animalImageContainer"></div>
    </div>

    <audio id="correctSound" src="sound/correct.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="sound/wrong.mp3" preload="auto"></audio>
    <audio id="animalSound" preload="auto"></audio>
    <audio id="backgroundMusic" src="sound/music.mp3" loop preload="auto"></audio>

    <script>
        const originalQuestions = [
            { id: 1, q: "T√¥i c√≥ chi·∫øc v√≤i d√†i, tai to, s·ªëng trong r·ª´ng. T√¥i l√† ai?", options: ["H·ªï", "Voi", "Nai"], answer: 1, image: "image/elephant.png", sound: "elephant.mp3" },
            { id: 2, q: "T√¥i nh·∫£y r·∫•t nhanh, th√≠ch ƒÉn chu·ªëi v√† leo c√¢y. T√¥i l√† ai?", options: ["Kh·ªâ", "S√≥c", "Voi"], answer: 0, image: "image/monkey.png", sound: "monkey.mp3" },
            { id: 3, q: "T√¥i c√≥ l√¥ng v·∫±n, g·∫ßm r·∫•t to. T√¥i l√† ai?", options: ["H·ªï", "Nai", "Kh·ªâ"], answer: 0, image: "image/tiger.png", sound: "tiger.mp3" },
            { id: 4, q: "T√¥i c√≥ g·∫°c ƒë·∫πp, ch·∫°y nhanh trong r·ª´ng. T√¥i l√† ai?", options: ["S√≥c", "Nai", "Voi"], answer: 1, image: "image/deer.png", sound: "deer.mp3" },
            { id: 5, q: "T√¥i nh·ªè b√©, ch·∫°y nhanh, th√≠ch ƒÉn h·∫°t v√† leo c√¢y gi·ªèi. T√¥i l√† ai?", options: ["Kh·ªâ", "S√≥c", "H·ªï"], answer: 1, image: "image/squirrel.png", sound: "squirrel.mp3" }
        ];

        let current = 0;
        let currentAnimalImage = null;
        let attemptsLeft = 2;
        let shuffledOptions = [];
        let correctAnswerIndexInShuffled = -1;
        let shuffledQuestions = [];
        let isMusicPlaying = false;
        let gameInProgress = false;

        // L·∫•y c√°c ph·∫ßn t·ª≠ DOM
        const questionElement = document.getElementById("question");
        const feedbackElement = document.getElementById("feedback");
        const nextBtn = document.getElementById("nextBtn");
        const animalImageContainer = document.getElementById("animalImageContainer");
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");
        const animalSound = document.getElementById("animalSound");
        const backgroundMusic = document.getElementById("backgroundMusic");
        const hintBtn = document.getElementById("hintBtn");
        const backToMenuBtn = document.getElementById("backToMenuBtn");

        const mainMenu = document.getElementById("mainMenu");
        const gameContainer = document.getElementById("gameContainer");
        const settingsPopup = document.getElementById("settingsPopup");

        const audioIcon = document.getElementById("audioIcon");
        const audioStatus = document.getElementById("audioStatus");

        // C√°c thanh tr∆∞·ª£t √¢m l∆∞·ª£ng
        const bgVolumeSlider = document.getElementById("bgVolume");
        const effectVolumeSlider = document.getElementById("effectVolume");
        const animalVolumeSlider = document.getElementById("animalVolume");

        // N√∫t "Ti·∫øp t·ª•c ch∆°i" v√† "B·∫Øt ƒë·∫ßu ch∆°i m·ªõi"
        const newGameBtn = document.getElementById("newGameBtn");
        const continueGameBtn = document.getElementById("continueGameBtn");

        // KH·ªûI T·∫†O answerButtons M·ªòT L·∫¶N KHI SCRIPT T·∫¢I
        // ƒê·∫£m b·∫£o d√≤ng n√†y n·∫±m sau khi c√°c ph·∫ßn t·ª≠ HTML ƒë√£ ƒë∆∞·ª£c t·∫£i (v√≠ d·ª•: cu·ªëi file script)
        const answerButtons = document.querySelectorAll(".answers button"); 

        // ƒê·∫∑t √¢m l∆∞·ª£ng ban ƒë·∫ßu cho t·∫•t c·∫£ c√°c √¢m thanh d·ª±a tr√™n gi√° tr·ªã c·ªßa thanh tr∆∞·ª£t
        function initializeVolumes() {
            backgroundMusic.volume = parseFloat(bgVolumeSlider.value);
            correctSound.volume = wrongSound.volume = parseFloat(effectVolumeSlider.value);
            animalSound.volume = parseFloat(animalVolumeSlider.value);
        }
        initializeVolumes();

        // H√†m m·ªõi: Hi·ªÉn th·ªã pop-up c√†i ƒë·∫∑t
        function showSettings() {
            settingsPopup.classList.remove("hidden");
        }

        // H√†m m·ªõi: ·∫®n pop-up c√†i ƒë·∫∑t
        function hideSettings() {
            settingsPopup.classList.add("hidden");
        }

        // H√†m x√°o tr·ªôn m·∫£ng (Fisher-Yates shuffle algorithm)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
            return array;
        }

        // H√†m b·∫≠t/t·∫Øt nh·∫°c n·ªÅn t·ªïng th·ªÉ
        function toggleBackgroundMusic() {
            if (isMusicPlaying) {
                backgroundMusic.pause();
                audioIcon.src = "ui/audio_off.png";
                audioStatus.textContent = "√Çm thanh: T·∫Øt";
                isMusicPlaying = false;
            } else {
                backgroundMusic.play().then(() => {
                    audioIcon.src = "ui/audio_on.png";
                    audioStatus.textContent = "√Çm thanh: B·∫≠t";
                    isMusicPlaying = true;
                }).catch(error => {
                    console.error("L·ªói khi ph√°t nh·∫°c n·ªÅn:", error);
                    audioIcon.src = "ui/audio_off.png";
                    audioStatus.textContent = "√Çm thanh: T·∫Øt";
                    isMusicPlaying = false;
                });
            }
        }

        // C√°c h√†m ƒë·ªÉ ƒëi·ªÅu ch·ªânh √¢m l∆∞·ª£ng ri√™ng bi·ªát
        function setBackgroundMusicVolume(volume) {
            backgroundMusic.volume = parseFloat(volume);
        }

        function setEffectSoundVolume(volume) {
            correctSound.volume = parseFloat(volume);
            wrongSound.volume = parseFloat(volume);
        }

        function setAnimalSoundVolume(volume) {
            animalSound.volume = parseFloat(volume);
        }

        // H√†m m·ªõi: B·∫Øt ƒë·∫ßu game (cho n√∫t "Ti·∫øp t·ª•c ch∆°i")
        function continueGame() {
            mainMenu.classList.add("hidden");
            gameContainer.classList.remove("hidden");
            // Ch·ªâ t·∫£i l·∫°i c√¢u h·ªèi hi·ªán t·∫°i n·∫øu game ƒëang trong qu√° tr√¨nh
            loadQuestion();
            // ƒê·∫£m b·∫£o nh·∫°c n·ªÅn ƒë∆∞·ª£c ph√°t khi game b·∫Øt ƒë·∫ßu
            if (!isMusicPlaying) {
                backgroundMusic.play().catch(err => console.warn("L·ªói khi ph√°t nh·∫°c n·ªÅn l√∫c ti·∫øp t·ª•c game:", err));
            }
        }

        // H√†m m·ªõi: B·∫Øt ƒë·∫ßu ch∆°i m·ªõi
        function startNewGame() {
            current = 0; // ƒê·∫∑t l·∫°i v·ªÅ c√¢u h·ªèi ƒë·∫ßu ti√™n
            shuffledQuestions = shuffleArray([...originalQuestions]); // X√°o tr·ªôn l·∫°i c√¢u h·ªèi
            gameInProgress = true; // ƒê·∫∑t tr·∫°ng th√°i game ƒëang di·ªÖn ra
            mainMenu.classList.add("hidden"); // ·∫®n m√†n h√¨nh menu
            gameContainer.classList.remove("hidden"); // Hi·ªán m√†n h√¨nh tr√≤ ch∆°i
            loadQuestion(); // T·∫£i c√¢u h·ªèi ƒë·∫ßu ti√™n
            // ƒê·∫£m b·∫£o nh·∫°c n·ªÅn ƒë∆∞·ª£c ph√°t khi game b·∫Øt ƒë·∫ßu
            if (!isMusicPlaying) {
                backgroundMusic.play().catch(err => console.warn("L·ªói khi ph√°t nh·∫°c n·ªÅn l√∫c b·∫Øt ƒë·∫ßu game m·ªõi:", err));
            }
        }

        // H√†m m·ªõi: Quay v·ªÅ m√†n h√¨nh ch√≠nh
        function backToMainMenu() {
            gameContainer.classList.add("hidden"); // ·∫®n m√†n h√¨nh game
            mainMenu.classList.remove("hidden"); // Hi·ªán m√†n h√¨nh menu ch√≠nh
            // D·ª´ng m·ªçi √¢m thanh game ƒëang ph√°t
            animalSound.pause();
            animalSound.currentTime = 0;
            correctSound.pause();
            correctSound.currentTime = 0;
            wrongSound.pause();
            wrongSound.currentTime = 0;
           
            // Hi·ªÉn th·ªã n√∫t "Ti·∫øp t·ª•c ch∆°i" n·∫øu game ƒëang d·ªü
            if (gameInProgress && current < shuffledQuestions.length) {
                continueGameBtn.classList.remove("hidden");
                newGameBtn.textContent = "Ch∆°i m·ªõi üéâ";
            } else {
                continueGameBtn.classList.add("hidden");
                newGameBtn.textContent = "Ch∆°i m·ªõi üéâ";
            }
        }

        function loadQuestion() {
            // Kh√¥ng c·∫ßn d√≤ng n√†y n·ªØa: answerButtons = document.querySelectorAll(".answers button");
           
            if (current >= shuffledQuestions.length) {
                showEndGameScreen();
                return;
            }
           
            const q = shuffledQuestions[current];
            questionElement.textContent = q.q;
            feedbackElement.textContent = "";
            feedbackElement.className = "feedback";
            nextBtn.classList.add("hidden");
            hintBtn.classList.remove("hidden");
            hintBtn.disabled = false;
            attemptsLeft = 2;
           
            if (currentAnimalImage) {
                currentAnimalImage.remove();
                currentAnimalImage = null;
            }
           
            shuffledOptions = shuffleArray([...q.options]);
            // ƒê·∫£m b·∫£o b·∫°n ƒëang t√≠nh to√°n ƒë√∫ng ch·ªâ m·ª•c c·ªßa c√¢u tr·∫£ l·ªùi sau khi x√°o tr·ªôn
            correctAnswerIndexInShuffled = shuffledOptions.indexOf(q.options[q.answer]);
           
            // L·∫∂P QUA C·∫¢ 3 N√öT ƒê·ªÇ C·∫¨P NH·∫¨T TR·∫†NG TH√ÅI V√Ä N·ªòI DUNG
            answerButtons.forEach((btn, i) => {
                // Ki·ªÉm tra xem c√≥ ƒë·ªß t√πy ch·ªçn cho n√∫t kh√¥ng
                if (shuffledOptions[i] !== undefined) {
                    btn.textContent = shuffledOptions[i];
                    btn.classList.remove('hidden'); // ƒê·∫£m b·∫£o n√∫t kh√¥ng b·ªã ·∫©n
                } else {
                    btn.textContent = ''; // X√≥a n·ªôi dung n·∫øu kh√¥ng c√≥ t√πy ch·ªçn
                    btn.classList.add('hidden'); // ·∫®n n√∫t n·∫øu kh√¥ng c√≥ t√πy ch·ªçn (ph√≤ng tr∆∞·ªùng h·ª£p c√¢u h·ªèi c√≥ √≠t h∆°n 3 ƒë√°p √°n)
                }
                btn.disabled = false;
                btn.style.background = 'linear-gradient(90deg, #64B5F6, #4DB6AC)';
                btn.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
                btn.classList.remove('correct', 'wrong');
            });
        }

        function checkAnswer(buttonIndex) {
            const q = shuffledQuestions[current];
           
            hintBtn.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t g·ª£i √Ω sau khi tr·∫£ l·ªùi
           
            if (buttonIndex === correctAnswerIndexInShuffled) {
                feedbackElement.textContent = `‚úÖ Ch√≠nh x√°c! Tuy·ªát v·ªùi!`;
                feedbackElement.className = "feedback";
                answerButtons[buttonIndex].classList.add('correct');
               
                answerButtons.forEach(btn => btn.disabled = true);
           
                confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } });
           
                const imageElement = document.createElement("img");
                imageElement.className = "animal-image";
                imageElement.src = q.image;
                animalImageContainer.appendChild(imageElement);
                currentAnimalImage = imageElement;
           
                correctSound.play().catch(err => console.error("L·ªói khi ph√°t correctSound:", err));
                setTimeout(() => {
                    animalSound.src = `sound/${q.sound}`;
                    animalSound.play().catch(err => console.error("L·ªói khi ph√°t ti·∫øng ƒë·ªông v·∫≠t:", err));
                }, 300);
           
                nextBtn.classList.remove("hidden");
            } else {
                attemptsLeft--;
                answerButtons[buttonIndex].classList.add('wrong');
                answerButtons[buttonIndex].disabled = true; // V√¥ hi·ªáu h√≥a n√∫t sai ƒë√£ ch·ªçn
                wrongSound.play().catch(err => console.error("L·ªói khi ph√°t wrongSound:", err));
           
                if (attemptsLeft === 0) {
                    feedbackElement.textContent = `‚ùå Ch∆∞a ƒë√∫ng r·ªìi! ƒê√°p √°n ch√≠nh x√°c l√† "${q.options[q.answer]}".`;
                    feedbackElement.className = "feedback wrong-final";
                    answerButtons.forEach((btn, i) => {
                        btn.disabled = true; // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ c√°c n√∫t
                        if (i === correctAnswerIndexInShuffled) {
                            btn.classList.add('correct'); // Hi·ªÉn th·ªã ƒë√°p √°n ƒë√∫ng
                        }
                    });
                    nextBtn.classList.remove("hidden");
                    
                    const imageElement = document.createElement("img");
                    imageElement.className = "animal-image";
                    imageElement.src = q.image;
                    animalImageContainer.appendChild(imageElement);
                    currentAnimalImage = imageElement;

                    setTimeout(() => {
                        animalSound.src = `sound/${q.sound}`;
                        animalSound.play().catch(err => console.error("L·ªói khi ph√°t ti·∫øng ƒë·ªông v·∫≠t:", err));
                    }, 300);

                } else {
                    feedbackElement.textContent = `Sai r·ªìi! Con c√≤n ${attemptsLeft} l∆∞·ª£t th·ª≠ n·ªØa. C·ªë l√™n!`;
                    feedbackElement.className = "feedback wrong-try-again";
                }
            }
        }

        function playHintSound() {
            const q = shuffledQuestions[current];
            animalSound.src = `sound/${q.sound}`;
            animalSound.play().catch(err => console.error("L·ªói khi ph√°t ti·∫øng ƒë·ªông v·∫≠t g·ª£i √Ω:", err));
            feedbackElement.textContent = "üé∂ Con h√£y l·∫Øng nghe ti·∫øng k√™u c·ªßa lo√†i v·∫≠t nh√©!";
            feedbackElement.className = "feedback hint-msg";
            hintBtn.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t g·ª£i √Ω sau khi s·ª≠ d·ª•ng
        }

        function nextQuestion() {
            current++;
            loadQuestion();
        }

        function showEndGameScreen() {
            questionElement.textContent = "üåü Hoan h√¥, nh√† th√°m hi·ªÉm t√†i ba! Con ƒë√£ xu·∫•t s·∫Øc kh√°m ph√° h·∫øt th·∫ø gi·ªõi ƒë·ªông v·∫≠t. H√£y ti·∫øp t·ª•c h·ªçc h·ªèi nh·ªØng ƒëi·ªÅu k·ª≥ di·ªáu xung quanh con nh√©! C·ªë g·∫Øng l√™n!"; // ƒê√£ s·ª≠a th√¥ng ƒëi·ªáp k·∫øt th√∫c
            feedbackElement.textContent = ""; // X√≥a ph·∫£n h·ªìi c≈©
            feedbackElement.className = "feedback correct"; // ƒê·ªÉ th√¥ng ƒëi·ªáp cu·ªëi m√†u xanh l√° c√¢y
            answerButtons.forEach(btn => btn.classList.add('hidden')); // ·∫®n c√°c n√∫t ƒë√°p √°n
            nextBtn.classList.add('hidden'); // ·∫®n n√∫t "C√¢u h·ªèi ti·∫øp theo"
            hintBtn.classList.add('hidden'); // ·∫®n n√∫t g·ª£i √Ω
            
            // X√≥a h√¨nh ·∫£nh n·∫øu c√≥
            if (currentAnimalImage) {
                currentAnimalImage.remove();
                currentAnimalImage = null;
            }

            // Hi·ªÉn th·ªã m·ªôt h√¨nh ·∫£nh ch√∫c m·ª´ng chung ho·∫∑c ƒë·ªÉ tr·ªëng
            const finalImageElement = document.createElement("img");
            finalImageElement.className = "animal-image";
            finalImageElement.src = "image/congratulations.png"; // Thay b·∫±ng ·∫£nh ch√∫c m·ª´ng c·ªßa b·∫°n
            animalImageContainer.appendChild(finalImageElement);
            currentAnimalImage = finalImageElement; // C·∫≠p nh·∫≠t bi·∫øn tham chi·∫øu
            
            // ƒê·∫∑t l·∫°i tr·∫°ng th√°i game
            gameInProgress = false;
            
            // Hi·ªÉn th·ªã l·∫°i n√∫t BackToMenu
            backToMenuBtn.classList.remove("hidden");
        }

        // T·∫£i c√¢u h·ªèi ƒë·∫ßu ti√™n khi trang t·∫£i (n·∫øu kh√¥ng ·ªü menu ch√≠nh)
        // window.onload = function() { // B·∫°n c√≥ th·ªÉ d√πng ƒëo·∫°n n√†y n·∫øu mu·ªën game t·ª± ƒë·ªông b·∫Øt ƒë·∫ßu
        //     loadQuestion();
        // };
        // Gi·ªù game s·∫Ω b·∫Øt ƒë·∫ßu t·ª´ menu ch√≠nh, n√™n kh√¥ng c·∫ßn loadQuestion ·ªü ƒë√¢y n·ªØa.
        // Ch·ªâ c·∫ßn ƒë·∫£m b·∫£o n√∫t "B·∫Øt ƒë·∫ßu ch∆°i m·ªõi" c√≥ t√™n ƒë√∫ng khi t·∫£i trang l·∫ßn ƒë·∫ßu
        newGameBtn.textContent = "B·∫Øt ƒë·∫ßu ch∆°i üéâ";
    </script>
</body>
</html>